---
################################################################################
# Setup configuration for Dotbot
#
# @see https://github.com/anishathalye/dotbot for more info
################################################################################

- defaults:
    shell:
      quiet: true
      description: <<<<<<<<####### DESCRIPTION MISSING

- shell:
    -
      description: Setup directories
      command: mkdir -p ~/github.com/davidsneighbour ~/gitlab.com/davidsneighbour ~/.config
    -
      description: Add individual PPAs
      command: |
        sudo add-apt-repository ppa:flatpak/stable --yes
        sudo add-apt-repository ppa:libreoffice/ppa --yes
        sudo add-apt-repository ppa:papirus/papirus --yes
    -
      description: Install essentials and requirements
      command: |
        sudo apt-get autoremove -y
        sudo apt-get install -y \
          arc-theme \                  # Arc GTK themegu
          build-essential \            # Essential compilation tools (gcc, g++, make, etc.)
          ca-certificates \            # SSL/TLS CA certificates for secure connections
          curl \                       # Command-line tool for HTTP/FTP requests
          dconf-editor \               # GUI tool to edit GNOME dconf settings
          dnsmasq-base \               # Lightweight DNS forwarder and DHCP server base
          file \                       # Utility to determine file types
          filezilla-theme-papirus \    # Papirus icon theme for FileZilla
          gir1.2-gtk-3.0 \             # Introspection data for GTK+ 3
          gir1.2-rsvg-2.0 \            # Introspection data for SVG rendering
          git \                        # Distributed version control system
          gzip \                       # Compression utility
          inxi \                       # System information script
          libgirepository1.0-dev \     # Development files for GObject introspection
          libgtk-3-dev \               # Development files for GTK+ 3
          librsvg2-bin \               # Tools for converting and rendering SVG files
          meson \                      # Fast build system
          papirus-folders \            # Folder color variations for Papirus icon theme
          papirus-icon-theme \         # Papirus icon theme package
          poppler-utils \              # PDF utilities (pdftotext, pdfinfo, etc.)
          procps \                     # Process management utilities (ps, top, etc.)
          python3 \                    # Python 3 interpreter
          python3-gi \                 # Python bindings for GObject introspection
          rofi \                       # Window switcher, run launcher, and dmenu replacement
          shutter \                    # Screenshot tool with annotation support
          vlc \                        # Media player supporting most formats
          xclip \                      # X11 clipboard command-line utility
          zoxide                       # Smarter cd command with learning and ranking capabilities
    -
      description: Install Homebrew
      command: |
        NONINTERACTIVE=1 \
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)" --quiet
    -
      description: Install Homebrew packages
      command: brew install git-delta zoxide typos-cli gum yamllint vale lychee python jrnl fastfetch
    -
      description: Install and setup Node and NPM
      command: |
        curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
        export NVM_DIR="$HOME/.nvm"
        [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
        [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"
        nvm install v20
        nvm install v22
        nvm install v24
        nvm use v24
    -
      description: Install Flatpak programs
      command: |
        flatpak install flathub be.alexandervanhee.gradia
        flatpak install flathub md.obsidian.Obsidian
    -
      description: Install rclone
      # https://rclone.org/downloads/
      command: |
        sudo -v ; curl https://rclone.org/install.sh | sudo bash
    -
      description: Install Starship (CLI prompt modification)
      command: |
        wget https://starship.rs/install.sh -O install.sh
        sh install.sh --verbose --yes
        rm install.sh
    -
      description: Install Deno
      command: curl -fsSL https://deno.land/install.sh | sh
    -
      description: Install Ollama (only on UNKLE)
      command: |
        if [[ "$(hostname)" == "unkle" ]]; then
            curl -fsSL https://ollama.com/install.sh | sh
            ollama pull llama3.2
            ollama pull gemma3
        fi
    -
      description: Install AnyDesk
      command: |
        if [[ "$(hostname)" == "unkle" ]]; then
          wget -qO - https://keys.anydesk.com/repos/DEB-GPG-KEY | sudo gpg --dearmor -o /usr/share/keyrings/anydesk.gpg
          echo "deb [signed-by=/usr/share/keyrings/anydesk.gpg] http://deb.anydesk.com/ubuntu focal main" | sudo tee /etc/apt/sources.list.d/anydesk.list
          sudo apt update && sudo apt install anydesk
          sudo systemctl disable --now anydesk.service 2>/dev/null || true
        fi

    -
      description: Remove unused packages
      command: |
        sudo apt purge --yes \
          *-cursor-theme yaru-*
    -
      description: Update system
      command: |
        sudo apt update
        sudo apt upgrade --yes
        sudo apt dist-upgrade --yes
        sudo apt autoremove --yes
        sudo apt clean --yes
    -
      description: System settings
      command: |
        gsettings set org.nemo.desktop show-desktop-icons false
    -
      description: Fix file rights for keys
      command: |
        chmod 0700 ~/.ssh
        chmod 0600 ~/.ssh/authorized_keys
        chmod 0600 ~/.ssh/id_ed25519
        chmod 0644 ~/.ssh/id_ed25519.pub
        chmod 0600 ~/.ssh/config
        chmod 0700 ~/.ssh/conf.d
        chmod 0600 ~/.ssh/conf.d/*
