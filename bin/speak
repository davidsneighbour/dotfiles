#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

speak() {
	if [[ "${1:-}" == "--help" || "${#}" -eq 0 ]]; then
		cat <<EOF
Usage: ${FUNCNAME[0]} [--help] <text>

Speak the provided text aloud using available TTS (Text-to-Speech) tools.

Examples:
  ${FUNCNAME[0]} "This is a test."
  echo "Another test" | ${FUNCNAME[0]}

Dependencies:
  - say (macOS) or espeak-ng (Linux)
EOF
		return 0
	fi

	local text
	if [[ -p /dev/stdin ]]; then
		text=$(cat)
	else
		text="$*"
	fi

	if command -v say >/dev/null 2>&1; then
		say "${text}"
	elif command -v espeak-ng >/dev/null 2>&1; then
		espeak-ng -v mb-en1 -s 120 "${text}"
	else
		echo "Error: No supported TTS program found (say or espeak-ng)." >&2
		return 1
	fi
}

# If executed directly (not sourced)
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
	speak "$@"
fi
